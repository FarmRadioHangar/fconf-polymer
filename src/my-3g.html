<link rel="import" href="../bower_components/polymer/polymer.html">
<link rel="import" href="../bower_components/gold-ip-input/gold-ip-input.html">
<link rel="import" href="../bower_components/paper-input/paper-input.html">
<link rel="import" href="../bower_components/paper-button/paper-button.html">
<link rel="import" href="../bower_components/paper-listbox/paper-listbox.html">
<link rel="import" href="../bower_components/paper-toggle-button/paper-toggle-button.html">
<link rel="import" href="../bower_components/paper-checkbox/paper-checkbox.html">
<link rel="import" href="../bower_components/paper-radio-group/paper-radio-group.html">
<link rel="import" href="../bower_components/paper-dropdown-menu/paper-dropdown-menu.html">
<link rel="import" href="../bower_components/uniflow-polymer/state-aware.html">
<link rel="import" href="../bower_components/uniflow-polymer/action-emitter.html">
<link rel="import" href="ras-3g.html">
<link rel="import" href="voice-channel.html">
<link rel="import" href="shared-styles.html">

<dom-module id="my-3g">
	<template>
		<style include="shared-styles">
			:host {
				display: block;
			}
		</style>
		ON/OFF
		<paper-toggle-button disabled=[[!_ifaceUsable(status)]] on-checked-changed="_enabledChanged" checked="[[enabled]]" notify>[[_ifaceStatus(status, enabled)]] ([[_humanMode(mode)]] mode)</paper-toggle-button>
			3G dongle mode: <paper-radio-group selected="{{_selected}}">
				<paper-radio-button name="ras">data</paper-radio-button>
				<paper-radio-button name="voice">voice</paper-radio-button>
			</paper-radio-group>
		<div class="card">
			<template is="dom-if" if="[[_isMode('ras', _selected)]]">
				<ras-3g
					name=[[name]]
					enabled=[[enabled]]
					config=[[ras.config]]
					defaults=[[ras.defaults]]
					mode=[[mode]]>
				</ras-3g>
			</template>
			<template is="dom-if" if="[[_isMode('voice', _selected)]]">
				<voice-channel
					name="[[name]]"
					enabled=[[enabled]]
					config=[[voice.config]]
					defaults=[[voice.defaults]]
					mode=[[mode]]>
				</voice-chennel>
			</template>
		</div>
	</template>

	<script>
		Polymer({
			is: 'my-3g',

			_humanMode: function(mode) {
				if (mode === 'ras') {
					return "data (RAS)";
				} else {
					return mode;
				}
			},
			_isMode: function(val, mode) {
				return mode === val;
			},

			_ifaceStatus: function(status, enabled) {
				//console.log('_ifaceStatus:');
				return (this._ifaceUsable(status) && enabled) ? "Enabled" : "Disabled";
			},
			_ifaceUsable: function(status) {
				//console.log('_ifaceUsable:');
				return true;
				return !!(status);
			},

			_isEnabled(enabled, mode) {
				return this.get('enabled') && (this.get('mode') === mode);
			},
			_enabledChanged: function (event, element) {
				console.log('_enabledChanged', event, element);
				this.emitAction({
					type: 'interfaceEnable',
					name: this.name,
					enabled: element.value
				});
				setTimeout(function(value) {
					if (value !== this.get('enabled')) {
						this.set('enabled', this.get('enabled'));
					}
				}.bind(this), 3000, element.value);
			},
			_modeChanged() {
				this.set('_selected', this.get('mode'));
			},
			properties: {
				name: {
					type: String,
				},
				mode: {
					type: String,
					observer: '_modeChanged',
				},
				enabled: {
					type: Boolean,
					value: false,
				//	observer: '_enabledChanged'
				},
			},

			behaviors: [
				UniFlow.ModelView
			],
		});
	</script>
</dom-module>
