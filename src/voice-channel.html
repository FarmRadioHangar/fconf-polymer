<link rel="import" href="../bower_components/polymer/polymer.html">
<link rel="import" href="../bower_components/gold-ip-input/gold-ip-input.html">
<link rel="import" href="../bower_components/paper-input/paper-input.html">
<link rel="import" href="../bower_components/paper-button/paper-button.html">
<link rel="import" href="../bower_components/paper-listbox/paper-listbox.html">
<link rel="import" href="../bower_components/paper-item/paper-item.html">
<link rel="import" href="../bower_components/paper-toggle-button/paper-toggle-button.html">
<link rel="import" href="../bower_components/paper-checkbox/paper-checkbox.html">
<link rel="import" href="../bower_components/paper-radio-group/paper-radio-group.html">
<link rel="import" href="../bower_components/paper-dropdown-menu/paper-dropdown-menu-light.html">
<link rel="import" href="../bower_components/uniflow-polymer/state-aware.html">
<link rel="import" href="../bower_components/uniflow-polymer/action-emitter.html">
<link rel="import" href="shared-styles.html">
<dom-module id="voice-channel">
	<template>
		<style include="shared-styles">
			:host {
				display: block;
			}
		</style>
		<template is="dom-if" if="[[status.isModified]]">
			<div class="notification">You have unsaved changes</div>
		</template>
		<h3>setup 3G voice dongle:</h3>
		<paper-input label="Number" value="{{model.number}}"></paper-input>
		<paper-input label="Label" value="{{model.label}}"></paper-input>
		<paper-input label="Name" value="{{model.name}}"></paper-input>
		<paper-checkbox checked={{model.outgoingCalls}}>Outgoing calls</paper-checkbox>
		<paper-checkbox checked={{model.outgoingSms}}>Outgoing SMS</paper-checkbox>
		<div>
			<paper-button raised on-tap="onSaveTap" disabled=[[!status.isModified]]>Apply changes</paper-button>
			<paper-button raised on-tap="discardChanges" disabled=[[!status.isModified]]>Discard</paper-button>
			<template is="dom-if" if="[[_hasDefaults(defaults)]]">
				<paper-button raised on-tap="loadDefaults">Load Defaults</paper-button>
			</template>
			<!--paper-button raised on-tap="removeConfig">Delete</paper-button-->
		</div>
	</template>

	<script>
		Polymer({
			is: 'voice-channel',

			properties: {
				enabled: {
					type: Boolean,
					value: false,
				//	observer: '_enabledChanged'
				},
				config: {
					type: Object,
					value: function() {
						return null;
					}
				},
				defaults: {
					type: Object,
					value: function() {
						return null;
					}
				}
			},
			observers: [
				'_configChanged(config.*, mode)',
			],
			behaviors: [
				UniFlow.ModelView
			],

			_isMode: 'ap',
			onSaveTap() {
				this.validateAndSave({
					type: 'interfaceUpdate',
					name: this.name,
					enabled: this.enabled,
					mode: this._isMode,
				});
			},
			discardChanges() {
				console.log('discardChanges', this.get('config'));
				this.set('model', JSON.parse(this.get('_model')));
			},
			loadDefaults() {
				if (this.defaults) {
					this.set('model', this.defaults);
					var _defaults = JSON.stringify(this.defaults);
					if (this._model !== _defaults) {
						this.set('status.isModified', true);
					}
				}
				console.log(this.config, this.model, this.status);
			},
			removeConfig() {
				this.emitAction({
					type: 'removeConfig',
					name: this.name,
				});
			},
			_configChanged(changeRecord) {
				this.set('model', this.config);
				this.set('_model', JSON.stringify(this.model));
				console.log('_configChanged', changeRecord.path, changeRecord.value, this.get('model'));
				if (this.get('mode') !== this._isMode) {
					this.set('status.isModified', true);
				}
			},
			_hasDefaults: function() {
				return !!this.defaults;
			},
		});
	</script>
</dom-module>
